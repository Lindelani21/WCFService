@model IEnumerable<Application>

@{
    ViewData["Title"] = "Applications Review Page";

    Application Selected = null;
    if(Model.Count()!=0)
        Selected = Model.ElementAt(0);
}

<div class="">
    <div class="row">
        <!--This will contain the whole side bar-->
        <div class="col-4 gap-2">
            @{
                string[] statuses = {"Pending", "Processing", "Processsed"};

                foreach (string status in statuses)
                {
                    <div>
                        <button type="button" class="btn bg-notice-me dropdown-toggle" data-bs-toggle="collapse" data-bs-target="@($"#{status}Application")" aria-controls="@($"{status}Application")">
                            @status
                        </button>

                        <div class="collapse" id="@($"{status}Application")">

                            @{
                                int Applications = 0;
                            }

                            @foreach (var application in Model)
                            {
                                if (application.Status == null || application.Status.ToLower() != status.ToLower())
                                    continue;

                                var applicant = RESTfulClient.Instance.GET<User>($"Users/{application.Id}");
                                string info = $"{applicant.Surname} {applicant.Name}\t";

                                Applications++;

                                <button class="btn btn-outline-secondary" id="@($"Application{application.ApplicationId}")">
                                    @info <strong class="alert-dark">@application.Module</strong>
                                </button>
                            }

                            @if(Applications == 0)
                            {
                                <span class="">
                                    There Are No @status Applications.
                                </span>
                            }

                        </div>
                    </div>
                }
            }
        </div>

        <!-- This will have the detailed application -->
        <div class="col-8">
            @{
                if(Selected != null)
                {
                    User applicant = RESTfulClient.Instance.GET<User>($"Users/{Selected.Id}");

                    <div class="">
                        <span>@($"Email Address: ")</span><span id="Email">@($"{applicant.StudentNum}@student.uj.ac.za")</span><br/>
                        <span>@($"Student Number: ")</span><span id="StudentNum">@($"{applicant.StudentNum}")</span><br/>
                        <span>@($"Title: ")</span><span id="Title">@($"{applicant.StudentNum}")</span><br/>
                        <span>@($"Surname: ")</span><span id="Surname">@($"{applicant.Surname}")</span><br/>
                        <span>@($"First Name: ")</span><span id="FirstName">@($"{applicant.Name}")</span><br/>
                    </div>

                    <div>
                        <span>@($"Academic Record: ")</span>
                        <button type="button" id="AcademicRecord" class="btn bg-notice-me">Will display later</button>
                                    
                        <div class="modal fade" tabindex="-1" id="AcademicRecord">
                            <div class="modal-dialog">
                                <div class="modal-content">
 
                                    <div class="modal-header bg-notice-me">
                                        <span>Academic Record</span>
                                        <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
                                    </div>

                                    <div class="modal-body">

                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                                        <p>Hello</p>
                                        <button type="button" class="btn btn-outline-secondary">Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <span class="align-self-center alert-heading">No Application Is Selected</span>
                }
            }
        </div>
    </div>
</div>

@foreach(Application application in Model)
{
    // 
    <style>
        $("@($"#Application{application.ApplicationId}")".on("click", function()
        {
            @Selected = application;
        });
    </style>
}
